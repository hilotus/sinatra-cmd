# encoding: utf-8

require File.expand_path('../boot', __FILE__)

Dir[File.expand_path('../../helpers/*.rb', __FILE__)].each { |f| require f }
Dir[File.expand_path('../../models/*.rb', __FILE__)].each { |f| require f }
Dir[File.expand_path('../../routes/*.rb', __FILE__)].each { |f| require f }

require File.expand_path('../scheduler', __FILE__)

module <%= app_name.capitalize %>
  class App
    # custome register
    register ErrorHandling

    # custome helpers
    helpers ApplicationHelper

    before do
      origin = request.env['HTTP_ORIGIN']
      headers("Access-Control-Allow-Origin" => origin ) if !origin.nil?
      # headers("Access-Control-Allow-Origin" => "*" )
      headers("Access-Control-Allow-Credentials" => "true")
      headers("Cache-Control" => "no-cache, no-store, private")
      headers("Content-Type" => "application/json; charset=UTF-8")
      headers("Access-Control-Allow-Methods" => "POST, GET, PUT, DELETE, OPTION")

      # fix Request header field Content-Type is not allowed by Access-Control-Allow-Headers.
      # http://stackoverflow.com/questions/5027705/error-in-chrome-content-type-is-not-allowed-by-access-control-allow-headers
      headers("Access-Control-Allow-Headers" => "Origin, X-Requested-With, Content-Type, Accept")

      # For options
      halt 200 if request.request_method == 'OPTIONS'
    end
  end
end
